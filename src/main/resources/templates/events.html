<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Мероприятия</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="bg-light">

<div th:replace="~{fragments/header :: header}"></div>

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary">Мероприятия в парке</h2>
        <div sec:authorize="hasRole('АДМИН') or hasRole('РАБОТНИК')">
            <a th:href="@{/events/edit}" class="btn btn-success btn-lg">
                <i class="bi bi-plus-circle"></i> Добавить мероприятие
            </a>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Поиск по названию</label>
                    <input type="text" name="title" class="form-control" th:value="${title}" placeholder="Введите название"/>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Цена от</label>
                    <input type="number" name="priceFrom" step="0.01" class="form-control" th:value="${priceFrom}" placeholder="0"/>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Цена до</label>
                    <input type="number" name="priceTo" step="0.01" class="form-control" th:value="${priceTo}" placeholder="10000"/>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Дата события</label>
                    <input type="date" name="date" class="form-control" th:value="${date}"/>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i> Поиск</button>
                </div>
            </form>
        </div>
    </div>

    <div class="row" th:if="${events != null and !events.isEmpty()}">
        <th:block th:each="event : ${events}">
            <div class="col-12 col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h4 class="card-title text-primary" th:text="${event.title}">Название события</h4>

                        <p class="mb-1"><strong>Дата:</strong> <span th:text="${#temporals.format(event.startTime, 'dd.MM.yyyy')}"></span></p>
                        <p class="mb-1"><strong>Время:</strong>
                            <span th:text="${#temporals.format(event.startTime, 'HH:mm')} + ' – ' + ${#temporals.format(event.endTime, 'HH:mm')}"></span>
                        </p>
                        <p class="mb-1"><strong>Локация:</strong> зона <span th:text="${event.location}"></span></p>
                        <p class="mb-1"><strong>Вместимость:</strong> <span th:text="${event.capacity} ?: 'не ограничена'"></span></p>
                        <p class="mb-3"><strong>Цена:</strong>
                            <span class="fw-bold" th:text="${event.price != null and event.price.doubleValue() > 0 ? event.price + ' ₽' : 'Бесплатно'}"></span>
                        </p>
                        <p class="card-text text-muted small mt-auto" th:text="${event.description}"></p>
                    </div>
                    <div class="card-footer d-flex flex-column gap-2">
                        <form th:action="@{/events/book/{id}(id=${event.id})}" method="post" class="d-grid gap-2"
                              sec:authorize="isAuthenticated()">
                            <button type="submit"
                                    class="btn btn-outline-success flex-fill"
                                    onclick="return confirm('Забронировать это мероприятие?')">
                                Забронировать
                            </button>
                        </form>

                        <div sec:authorize="hasRole('АДМИН') or hasRole('РАБОТНИК')" class="d-flex gap-2 w-100">
                            <a th:href="@{/events/edit/{id}(id=${event.id})}"
                               class="btn btn-warning btn-sm">
                                <i class="bi bi-pencil"></i> Редактировать
                            </a>
                            <a th:href="@{/events/delete/{id}(id=${event.id})}"
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('Удалить мероприятие?')">
                                <i class="bi bi-trash"></i> Удалить
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </th:block>
    </div>

    <div th:if="${events == null or events.isEmpty()}" class="text-center py-5">
        <h4 class="text-muted">Мероприятия не найдены</h4>
        <p>Попробуйте изменить параметры поиска или добавить новое мероприятие.</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>